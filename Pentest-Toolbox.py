import pyfiglet
import sys

from MODULES.ScanPort import Nmap_silent
from MODULES.ScanPort import Nmap_classic
#from MODULES.searchsploitCli import exploitdbSearch

def scan_submenu():
    print(pyfiglet.figlet_format("Scanning Menu"))
    print("1-NMAP classic")
    print("2-NMAP silent")
    print("3-Back to main menu")
    print("4-Quit")
    choice = input("Choose an option : ")
    if choice == "1":
        target = str(input("Set target IP\n> "))
        resultat, versions_all = Nmap_classic(target)
        print(resultat)
        for product, version in versions_all.items():
            if product is not None and version is not None:
                print("OK")
                #exploit = exploitdbSearch(product + " " + version)
                #print(exploit)
            else:
                print("Version or service not found")
                scan_submenu()
        scan_submenu()
    elif choice == "2":
        target = str(input("Set target IP\n> "))
        print(Nmap_silent(target))
        scan_submenu()
    elif choice == "3":
        main_menu()
    elif choice == "4":
        sys.exit()
    else:
        print("Invalid option, please try again.")
        scan_submenu()

def exploit_submenu():
    print(pyfiglet.figlet_format("Exploit Menu"))
    print("1-Pseudo Research (Sherlock)")
    print("2-Exploit vulnérabilité 2")
    print("3-Retour au menu principal")
    print("4-Quit")
    choice = input("Choisissez une option : ")
    if choice == "1":
        print("Exploitation de la vulnérabilité 1 en cours...")
    elif choice == "2":
        print("Exploitation de la vulnérabilité 2 en cours...")
    elif choice == "3":
        main_menu()
    elif choice == "4":
        sys.exit()
    else:
        print("Invalid option, please try again.")
        exploit_submenu()

def main_menu():
    print("(c) Copyright 2023, Jeannot & Mascarilla")
    print(pyfiglet.figlet_format("Pentest ToolBox"))
    print("1-Scanning")
    print("2-Exploit")
    print("5-Quit")
    choice = input("Choose an option : ")
    if choice == "1":
        scan_submenu()
    elif choice == "2":
        exploit_submenu()
    elif choice == "5":
        sys.exit()
    else:
        print("Invalid option, please try again.")
        main_menu()

main_menu()
